<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Producción</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-lg-2 col-md-3 d-md-block sidebar collapse">
            <div class="position-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#dashboard" data-page="dashboard">
                            <i class="fas fa-chart-line me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#materials" data-page="materials">
                            <i class="fas fa-cube me-2"></i>Materiales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#products" data-page="products">
                            <i class="fas fa-box-open me-2"></i>Productos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#cost-calculation" data-page="cost-calculation">
                            <i class="fas fa-calculator me-2"></i>Cálculo de Costos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#inventory" data-page="inventory">
                            <i class="fas fa-warehouse me-2"></i>Inventario
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#production-orders" data-page="production-orders">
                            <i class="fas fa-industry me-2"></i>Órdenes de Producción
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reports" data-page="reports">
                            <i class="fas fa-file-alt me-2"></i>Reportes
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
            <button class="navbar-toggler d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="page-content" id="dashboard-page">
                <h1 class="mt-4">Dashboard</h1>
                <hr>
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-0">Costo Promedio</p>
                                    <h2 class="fw-bold">$<span id="avg-cost">0.00</span></h2>
                                </div>
                                <i class="icon-card fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-0">Órdenes Activas</p>
                                    <h2 class="fw-bold"><span id="active-orders">0</span></h2>
                                </div>
                                <i class="icon-card fas fa-clipboard-list"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-0">Stock Bajo</p>
                                    <h2 class="fw-bold"><span id="low-stock">0</span></h2>
                                </div>
                                <i class="icon-card fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card p-4">
                            <h4>Costo por Orden de Producción</h4>
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-content" id="materials-page" style="display:none;">
                <h1 class="mt-4">Gestión de Materiales</h1>
                <hr>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h4>Cargar Materiales desde Excel</h4>
                    </div>
                    <div class="card-body">
                        <form id="uploadMaterialForm">
                            <div class="mb-3">
                                <label for="materialFile" class="form-label">Seleccione el archivo de materiales (.xlsx, .xls, .csv)</label>
                                <input class="form-control" type="file" id="materialFile" accept=".xlsx, .xls, .csv" required>
                            </div>
                            <button type="submit" class="btn btn-success">Cargar Materiales</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h4>Añadir Material Individualmente</h4>
                    </div>
                    <div class="card-body">
                        <form id="addMaterialForm">
                            <div class="mb-3">
                                <label for="addMaterialCode" class="form-label">Código</label>
                                <input type="text" class="form-control" id="addMaterialCode" required>
                            </div>
                            <div class="mb-3">
                                <label for="addMaterialDescription" class="form-label">Descripción</label>
                                <input type="text" class="form-control" id="addMaterialDescription" required>
                            </div>
                            <div class="mb-3">
                                <label for="addMaterialCost" class="form-label">Costo</label>
                                <input type="number" step="0.01" class="form-control" id="addMaterialCost" required>
                            </div>
                            <div class="mb-3">
                                <label for="addMaterialUnit" class="form-label">Unidad</label>
                                <input type="text" class="form-control" id="addMaterialUnit" required>
                            </div>
                            <div class="mb-3">
                                <label for="addMaterialExistence" class="form-label">Existencia</label>
                                <input type="number" class="form-control" id="addMaterialExistence" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Añadir Material</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-4 p-3">
                    <h4>Lista de Materiales</h4>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Descripción</th>
                                    <th>Costo</th>
                                    <th>Unidad</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="materialsTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page-content" id="products-page" style="display:none;">
                <h1 class="mt-4">Gestión de Productos</h1>
                <hr>
                <div class="card mt-4">
                    <div class="card-header">
                        <h4>Cargar Productos desde Excel</h4>
                    </div>
                    <div class="card-body">
                        <form id="uploadProductForm">
                            <div class="mb-3">
                                <label for="productFile" class="form-label">Seleccione el archivo de productos (.xlsx, .xls, .csv)</label>
                                <input class="form-control" type="file" id="productFile" accept=".xlsx, .xls, .csv" required>
                            </div>
                            <button type="submit" class="btn btn-success">Cargar Productos</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h4>Añadir Producto Individualmente</h4>
                    </div>
                    <div class="card-body">
                        <form id="addProductForm">
                            <div class="mb-3">
                                <label for="addProductId" class="form-label">ID del Producto</label>
                                <input type="text" class="form-control" id="addProductId" required>
                            </div>
                            <div class="mb-3">
                                <label for="addProductName" class="form-label">Nombre del Producto</label>
                                <input type="text" class="form-control" id="addProductName" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Añadir Producto</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-4 p-3">
                    <h4>Lista de Productos</h4>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Costo Estándar</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="page-content" id="cost-calculation-page" style="display:none;">
                <h1 class="mt-4">Cálculo de Costos Estándar</h1>
                <hr>
                <div class="card p-4">
                    <form id="costo-form">
                        <div class="mb-3">
                            <label for="productSelect" class="form-label">Seleccione un Producto</label>
                            <select class="form-control" id="productSelect" required>
                                <option value="">Seleccione un producto</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Calcular Costo</button>
                    </form>

                    <div id="costResult" class="mt-4" style="display:none;">
                        <h4>Detalle del Costo Estándar</h4>
                        <p><strong>Costo Estándar Total:</strong> $<span id="standardCostValue"></span></p>
                        <p><strong>Costo de Materiales:</strong> $<span id="materialsCost"></span></p>
                        <p><strong>Costo de Empaque:</strong> $<span id="packagingCost"></span></p>
                    </div>
                </div>
            </div>

            <div class="page-content" id="inventory-page" style="display:none;">
                <h1 class="mt-4">Inventario de Materiales</h1>
                <hr>
                <div class="card p-3">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Descripción</th>
                                    <th>Existencia</th>
                                    <th>Unidad</th>
                                    <th>Costo Unitario</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page-content" id="production-orders-page" style="display:none;">
                <h1 class="mt-4">Órdenes de Producción</h1>
                <hr>
                <div class="card p-3">
                    <form id="productionOrderForm">
                        <div class="mb-3">
                            <label for="orderProductSelect" class="form-label">Producto a Producir</label>
                            <select class="form-control" id="orderProductSelect" required>
                                <option value="">Seleccione un producto</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="orderQuantity" class="form-label">Cantidad</label>
                            <input type="number" class="form-control" id="orderQuantity" required>
                        </div>
                        <div class="mb-3">
                            <label for="orderOperator" class="form-label">Operador</label>
                            <input type="text" class="form-control" id="orderOperator" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Crear Orden</button>
                    </form>
                </div>

                <div class="card mt-4 p-3">
                    <h4>Lista de Órdenes</h4>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID de Orden</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Fecha de Inicio</th>
                                    <th>Fecha de Finalización</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page-content" id="reports-page" style="display:none;">
                <h1 class="mt-4">Reportes de Producción</h1>
                <hr>
                <div class="card p-4 mb-4">
                    <h4>Generar Reporte</h4>
                    <form id="productionReportForm" class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label for="reportProductFilter" class="form-label">Filtrar por Producto</label>
                            <select class="form-control" id="reportProductFilter">
                                <option value="">Todos los productos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="reportOrderIdFilter" class="form-label">Filtrar por ID de Orden</label>
                            <input type="text" class="form-control" id="reportOrderIdFilter" placeholder="ID de Orden">
                        </div>
                        <div class="col-md-3">
                            <label for="reportOperatorFilter" class="form-label">Filtrar por Operador</label>
                            <input type="text" class="form-control" id="reportOperatorFilter" placeholder="Nombre del Operador">
                        </div>
                        <div class="col-md-3">
                            <label for="reportStartDate" class="form-label">Desde</label>
                            <input type="date" class="form-control" id="reportStartDate">
                        </div>
                        <div class="col-md-3">
                            <label for="reportEndDate" class="form-label">Hasta</label>
                            <input type="date" class="form-control" id="reportEndDate">
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary w-100">Generar Reporte</button>
                        </div>
                    </form>

                    <div id="reportResults" class="mt-4">
                        <h4>Resultados del Reporte</h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID de Orden</th>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Operador</th>
                                        <th>Fecha de Inicio</th>
                                        <th>Fecha de Finalización</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card p-4 mt-4">
                    <h4>Copia de Seguridad y Restauración</h4>
                    <p>Guarda y restaura todos los datos de tu aplicación (Materiales, Productos, Recetas y Órdenes de Producción).</p>
                    <div class="d-flex gap-2">
                        <button id="exportDataBtn" class="btn btn-secondary"><i class="fas fa-download me-2"></i>Exportar Datos</button>
                        <div class="btn btn-success position-relative overflow-hidden">
                            <i class="fas fa-upload me-2"></i>Cargar Copia de Seguridad
                            <input type="file" id="importFile" class="position-absolute top-0 start-0 w-100 h-100 opacity-0 cursor-pointer" accept=".json">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="modal fade" id="editMaterialModal" tabindex="-1" aria-labelledby="editMaterialModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMaterialModalLabel">Editar Material</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editMaterialForm">
                    <div class="mb-3">
                        <label for="editMaterialCode" class="form-label">Código</label>
                        <input type="text" class="form-control" id="editMaterialCode" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editMaterialDescription" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="editMaterialDescription" required>
                    </div>
                    <div class="mb-3">
                        <label for="editMaterialCost" class="form-label">Costo</label>
                        <input type="number" step="0.01" class="form-control" id="editMaterialCost" required>
                    </div>
                    <div class="mb-3">
                        <label for="editMaterialUnit" class="form-label">Unidad</label>
                        <input type="text" class="form-control" id="editMaterialUnit" required>
                    </div>
                    <div class="mb-3">
                        <label for="editMaterialExistence" class="form-label">Existencia</label>
                        <input type="number" class="form-control" id="editMaterialExistence" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="manageRecipeModal" tabindex="-1" aria-labelledby="manageRecipeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="manageRecipeModalLabel">Receta para: <span id="recipeProductName"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addRecipeItemForm" class="row g-3">
                    <div class="col-md-6">
                        <label for="recipeMaterialSelect" class="form-label">Código de Material</label>
                        <select class="form-control" id="recipeMaterialSelect" required>
                            <option value="">Seleccione un material</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="recipeQuantity" class="form-label">Cantidad</label>
                        <input type="number" step="0.01" class="form-control" id="recipeQuantity" required>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100">Añadir</button>
                    </div>
                </form>
                
                <h5 class="mt-4">Lista de Materiales de la Receta</h5>
                <div class="table-responsive">
                    <table class="table table-striped mt-2">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Descripción</th>
                                <th>Cantidad</th>
                                <th>Unidad</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="recipeTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderDetailsModalLabel">Detalle de la Orden de Producción</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="orderDetailsContent">
                    <h5>Información de la Orden</h5>
                    <ul class="list-group list-group-flush mb-4">
                        <li class="list-group-item"><strong>ID de Orden:</strong> <span id="detailOrderId"></span></li>
                        <li class="list-group-item"><strong>Producto:</strong> <span id="detailProductName"></span></li>
                        <li class="list-group-item"><strong>Cantidad a Producir:</strong> <span id="detailQuantity"></span></li>
                        <li class="list-group-item"><strong>Operador:</strong> <span id="detailOperator"></span></li>
                        <li class="list-group-item"><strong>Fecha de Creación:</strong> <span id="detailStartDate"></span></li>
                        <li class="list-group-item"><strong>Estado:</strong> <span id="detailStatus"></span></li>
                    </ul>

                    <h5>Materiales Requeridos para la Orden</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Descripción</th>
                                    <th>Cantidad Requerida</th>
                                    <th>Unidad</th>
                                </tr>
                            </thead>
                            <tbody id="requiredMaterialsTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-info" id="printOrderBtn"><i class="fas fa-print"></i> Imprimir</button>
                <button type="button" class="btn btn-danger" id="downloadPdfBtn"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
