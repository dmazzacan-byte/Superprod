<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operis - Gestión de Producción</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Lato:wght@400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
      @media print {
        /* Hide sidebar, modals, and other non-essential elements */
        #sidebar, .modal, .modal-backdrop {
          display: none !important;
        }

        /* By default, hide all pages from printing */
        .page-content {
          display: none !important;
        }

        /* Only show the page that has been explicitly marked for printing */
        .page-content.printable-page {
          display: block !important;
        }

        /* Inside the printable page, hide the header that contains the print/pdf buttons */
        .printable-page .d-flex.justify-content-between.align-items-center {
            display: none !important;
        }

        /* Ensure the main content area expands to fill the page */
        #mainContent {
          width: 100% !important;
          margin: 0 !important;
          padding: 1rem !important;
        }

        .card, .kpi-card, .table-responsive {
            page-break-inside: avoid;
        }
      }
    </style>
</head>
<body>

<div id="splashScreen">
    <h1 class="splash-title">Operis</h1>
    <p class="splash-tagline">Gestión de producción clara, simple y poderosa.</p>
</div>

<!-- Login View -->
<div id="loginView" class="container">
    <div class="row justify-content-center align-items-center vh-100">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg">
                <div class="card-body p-5">
                    <h3 class="card-title text-center">Operis</h3>
                    <p class="text-center text-muted mb-4">Gestión de producción clara, simple y poderosa.</p>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                Iniciar Sesión
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main App View -->
<div id="appView" class="d-none">
    <div id="userInfoHeader">
        <span id="userData" class="me-3"></span>
        <button id="logoutBtn" class="btn btn-danger" title="Cerrar Sesión">
            <i class="fas fa-power-off"></i>
        </button>
    </div>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebar" class="col-lg-2 col-md-3 d-md-block sidebar collapse">
                <div class="position-sticky">
                    <h4 class="text-white text-center my-3">Operis</h4>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#dashboardPage" data-page="dashboardPage"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                        <li class="nav-item"><a class="nav-link" href="#demandPlannerPage" data-page="demandPlannerPage"><i class="fas fa-bullseye"></i> Planificador</a></li>
                        <li class="nav-item"><a class="nav-link" href="#productsPage" data-page="productsPage"><i class="fas fa-boxes"></i> Productos</a></li>
                        <li class="nav-item"><a class="nav-link" href="#materialsPage" data-page="materialsPage"><i class="fas fa-cubes"></i> Materiales</a></li>
                        <li class="nav-item"><a class="nav-link" href="#recipesPage" data-page="recipesPage"><i class="fas fa-book"></i> Recetas</a></li>
                        <li class="nav-item"><a class="nav-link" href="#productionOrdersPage" data-page="productionOrdersPage"><i class="fas fa-clipboard-list"></i> Órdenes</a></li>
                        <li class="nav-item"><a class="nav-link" href="#reportsPage" data-page="reportsPage"><i class="fas fa-chart-pie"></i> Reportes</a></li>
                        <li class="nav-item"><a class="nav-link" href="#settingsPage" data-page="settingsPage"><i class="fas fa-cog"></i> Configuración</a></li>
                    </ul>
                </div>
            </nav>

            <main id="mainContent" class="col-lg-10 col-md-9 ms-sm-auto px-md-4">
                <!-- Dashboard -->
                <div class="page-content" id="dashboardPage">
                    <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <div>
                            <h1 class="h2">Dashboard de Producción (Mes en Curso)</h1>
                            <p class="text-muted mb-0">Fecha de generación: <span class="report-timestamp"></span></p>
                        </div>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="dashboardPdfBtn"><i class="fas fa-file-pdf me-2"></i>Descargar PDF</button>
                        </div>
                    </div>
                    <div class="row g-4 mt-2 justify-content-center">
                        <div class="col-lg col-md-6"><div class="kpi-card h-100"><div class="card-body"><h6 class="kpi-title">ÓRDENES PENDIENTES</h6><p class="kpi-value" id="pendingOrdersCard">0</p></div></div></div>
                        <div class="col-lg col-md-6"><div class="kpi-card h-100"><div class="card-body"><h6 class="kpi-title">ÓRDENES COMPLETADAS</h6><p class="kpi-value" id="completedOrdersCard">0</p></div></div></div>
                        <div class="col-lg col-md-6"><div class="kpi-card h-100"><div class="card-body"><h6 class="kpi-title">PRODUCCIÓN TOTAL</h6><p class="kpi-value" id="totalProductionCard">0</p></div></div></div>
                        <div class="col-lg col-md-6"><div class="kpi-card h-100"><div class="card-body"><h6 class="kpi-title">COSTO REAL TOTAL</h6><p class="kpi-value" id="totalCostCard">$0.00</p></div></div></div>
                        <div class="col-lg col-md-6"><div class="kpi-card h-100"><div class="card-body"><h6 class="kpi-title">SOBRECOSTO TOTAL</h6><p class="kpi-value" id="totalOvercostCard">$0.00</p></div></div></div>
                    </div>
                    <div class="row g-4 mt-4">
                        <div class="col-lg-4"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Producción por Operador</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-sm table-hover mb-0"><thead><tr><th>#</th><th>Operador</th><th>Unidades</th></tr></thead><tbody id="operatorProductionRankBody"></tbody></table></div></div></div></div>
                        <div class="col-lg-4"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Sobrecosto por Operador</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-sm table-hover mb-0"><thead><tr><th>#</th><th>Operador</th><th>Sobrecosto</th></tr></thead><tbody id="operatorOvercostRankBody"></tbody></table></div></div></div></div>
                        <div class="col-lg-4"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Producción por Equipo</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-sm table-hover mb-0"><thead><tr><th>#</th><th>Equipo</th><th>Unidades</th></tr></thead><tbody id="equipoProductionRankBody"></tbody></table></div></div></div></div>
                    </div>
                    <!-- Chart Row 1: Production -->
                    <div class="row g-4 mt-4">
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Producción por Producto (Top 5)</h5></div><div class="card-body"><canvas id="productionChart"></canvas></div></div></div>
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Producción Diaria (Productos Finales)</h5></div><div class="card-body"><canvas id="dailyProductionChart"></canvas></div></div></div>
                    </div>

                    <!-- Chart Row 2: Costs -->
                    <div class="row g-4 mt-4">
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Costo Unitario por Producto (Top 5)</h5></div><div class="card-body d-flex align-items-center justify-content-center"><canvas id="costChart"></canvas></div></div></div>
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Sobrecosto Diario</h5></div><div class="card-body"><canvas id="dailyOvercostChart"></canvas></div></div></div>
                    </div>
                    <div class="row g-4 mt-4">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-header bg-warning-subtle d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 text-dark"><i class="fas fa-exclamation-triangle me-2"></i>Alertas de Bajo Inventario</h5>
                                    <div class="d-flex align-items-center">
                                        <div class="me-3">
                                            <label for="dashboardAlmacenFilter" class="me-2 text-dark fw-bold small">Almacén:</label>
                                            <select id="dashboardAlmacenFilter" class="form-select form-select-sm" style="width: 150px; display: inline-block;"></select>
                                        </div>
                                        <div>
                                            <label for="lowStockThreshold" class="me-2 text-dark fw-bold small">Límite:</label>
                                            <input type="number" id="lowStockThreshold" class="form-control form-control-sm" value="10" style="width: 80px; display: inline-block;">
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Material</th>
                                                    <th>Existencia Actual</th>
                                                    <th>Unidad</th>
                                                    <th>Productos Afectados</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lowStockTableBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Planificador de Demanda -->
                <div class="page-content" id="demandPlannerPage" style="display: none;">
                    <h1 class="mt-4">Planificador de Demanda</h1>
                    <div class="card shadow-sm mt-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Paso 1: Ingresar Pronóstico de Ventas</h5>
                        </div>
                        <div class="card-body">
                            <form id="demandPlannerForm">
                                <div id="forecast-entries">
                                    <div class="row g-3 align-items-center forecast-entry mb-2">
                                        <div class="col-md-6">
                                            <label class="form-label">Producto</label>
                                            <select class="form-select forecast-product"></select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Cantidad Requerida</label>
                                            <input type="number" class="form-control forecast-quantity" min="1" placeholder="Ej: 100">
                                        </div>
                                        <div class="col-md-2 d-flex align-items-end">
                                            <button type="button" class="btn btn-danger w-100 remove-forecast-btn"><i class="fas fa-trash"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-success mt-2" id="addForecastEntryBtn"><i class="fas fa-plus"></i> Añadir Producto</button>
                            </form>
                        </div>
                    </div>

                    <div class="card shadow-sm mt-4">
                        <div class="card-body">
                            <div class="row align-items-end">
                                <div class="col-md-4">
                                    <label for="plannerAlmacenSelect" class="form-label fw-bold">Verificar Inventario Contra:</label>
                                    <select id="plannerAlmacenSelect" class="form-select">
                                        <!-- Opciones de almacén se llenarán con JS -->
                                    </select>
                                </div>
                                <div class="col-md-8">
                                     <button class="btn btn-primary btn-lg me-3" id="calculatePlanBtn"><i class="fas fa-calculator me-2"></i>Calcular Plan</button>
                                     <button class="btn btn-secondary btn-lg" id="newPlanBtn"><i class="fas fa-sync-alt me-2"></i>Nuevo Plan</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mt-4" id="suggestedOrdersCard" style="display: none;">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Paso 2: Órdenes de Producción Sugeridas</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" id="selectAllSuggestions" checked></th>
                                            <th>Producto</th>
                                            <th>Necesidad Neta</th>
                                            <th>Inventario</th>
                                            <th>Pronóstico</th>
                                            <th>Operador</th>
                                            <th>Equipo</th>
                                        </tr>
                                    </thead>
                                    <tbody id="suggestedOrdersTableBody">
                                        <!-- Las filas se generarán con JS -->
                                    </tbody>
                                </table>
                            </div>
                            <button class="btn btn-success btn-lg mt-3" id="createSelectedOrdersBtn"><i class="fas fa-check-circle me-2"></i>Crear Órdenes Seleccionadas</button>
                        </div>
                    </div>
                </div>

                <!-- Productos -->
                <div class="page-content" id="productsPage" style="display: none;">
                    <h1 class="mt-4">Productos</h1>
                    <div class="d-flex justify-content-between mb-3 mt-4">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal"><i class="fas fa-plus me-2"></i> Añadir Producto</button>
                        <div class="d-flex">
                            <button class="btn btn-secondary me-2" id="importProductsBtn"><i class="fas fa-upload me-2"></i> Importar</button>
                            <input type="file" id="productFile" accept=".csv, .xlsx" class="d-none">
                            <button class="btn btn-info" id="exportProductsBtn"><i class="fas fa-download me-2"></i> Exportar</button>
                        </div>
                    </div>
                    <input type="text" class="form-control mb-3" id="searchProduct" placeholder="Buscar por código o descripción...">
                    <div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Código</th><th>Descripción</th><th>Unidad</th><th>Acciones</th></tr></thead><tbody id="productsTableBody"></tbody></table></div>
                </div>

                <!-- Materiales -->
                <div class="page-content" id="materialsPage" style="display: none;">
                    <h1 class="mt-4">Materiales</h1>
                    <div class="d-flex justify-content-between mb-3 mt-4">
                        <div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#materialModal"><i class="fas fa-plus me-2"></i> Añadir Material</button>
                            <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#traspasoModal"><i class="fas fa-exchange-alt me-2"></i> Realizar Traspaso</button>
                        </div>
                        <div class="d-flex">
                            <button class="btn btn-secondary me-2" id="importMaterialsBtn"><i class="fas fa-upload me-2"></i> Importar</button>
                            <input type="file" id="materialFile" accept=".csv, .xlsx" class="d-none">
                            <button class="btn btn-info" id="exportMaterialsBtn"><i class="fas fa-download me-2"></i> Exportar</button>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <input type="text" class="form-control" id="searchMaterial" placeholder="Buscar por código o descripción...">
                        <div class="form-check ms-3">
                            <input class="form-check-input" type="checkbox" value="" id="filterMaterialsAsProducts">
                            <label class="form-check-label" for="filterMaterialsAsProducts">
                                Productos
                            </label>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead id="materialsTableHead">
                                <!-- Headers are now generated by JS -->
                            </thead>
                            <tbody id="materialsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Recetas -->
                <div class="page-content" id="recipesPage" style="display: none;">
                    <h1 class="mt-4">Recetas</h1>
                    <div class="d-flex justify-content-between mb-3 mt-4">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRecipeModal"><i class="fas fa-plus me-2"></i> Añadir Receta</button>
                        <div class="d-flex">
                            <button class="btn btn-secondary me-2" id="importRecipesBtn"><i class="fas fa-upload me-2"></i> Importar</button>
                            <input type="file" id="recipeFile" accept=".csv, .xlsx" class="d-none">
                            <button class="btn btn-info me-2" id="exportRecipesBtn"><i class="fas fa-download me-2"></i> Exportar</button>
                            <button class="btn btn-danger" id="exportAllRecipesPdfBtn"><i class="fas fa-file-pdf me-2"></i> Descargar Todas (PDF)</button>
                        </div>
                    </div>
                    <div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Código</th><th>Producto</th><th>Nº Materiales</th><th>Costo Estándar</th><th>Acciones</th></tr></thead><tbody id="recipesTableBody"></tbody></table></div>
                </div>

                <!-- Órdenes -->
                <div class="page-content" id="productionOrdersPage" style="display: none;">
                    <h1 class="mt-4">Órdenes de Producción</h1>
                    <div class="d-flex justify-content-between align-items-center mb-3 mt-4">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productionOrderModal"><i class="fas fa-plus me-2"></i> Crear Orden</button>
                        <div class="input-group w-50">
                            <input type="text" class="form-control" id="searchOrder" placeholder="Buscar por ID de orden o producto...">
                            <button class="btn btn-outline-secondary" id="toggleOrderSortBtn" title="Cambiar Orden">
                                <i class="fas fa-sort-amount-down-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>ID Orden</th><th>Producto</th><th>Cant. Plan/Real</th><th>Costo Real</th><th>Sobrecosto</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="productionOrdersTableBody"></tbody></table></div>
                </div>

                <!-- Reportes -->
                <div class="page-content" id="reportsPage" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <div>
                            <h1 class="h2">Centro de Reportes</h1>
                            <p class="text-muted mb-0">Fecha de generación: <span class="report-timestamp"></span></p>
                        </div>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="reportsPdfBtn"><i class="fas fa-file-pdf me-2"></i>Descargar PDF</button>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="card shadow-sm mt-4">
                        <div class="card-header"><h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros de Búsqueda</h5></div>
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-3"><label for="startDateFilter" class="form-label">Fecha de Inicio</label><input type="date" class="form-control" id="startDateFilter"></div>
                                <div class="col-md-3"><label for="endDateFilter" class="form-label">Fecha de Fin</label><input type="date" class="form-control" id="endDateFilter"></div>
                                <div class="col-md-2"><label for="productFilter" class="form-label">Producto</label><select id="productFilter" class="form-select"></select></div>
                                <div class="col-md-2"><label for="operatorFilter" class="form-label">Operador</label><select id="operatorFilter" class="form-select"></select></div>
                                <div class="col-md-2"><label for="equipoFilter" class="form-label">Equipo</label><select id="equipoFilter" class="form-select"></select></div>
                                <div class="col-md-2"><button class="btn btn-primary w-100" id="applyReportFilters"><i class="fas fa-search me-2"></i>Buscar</button></div>
                            </div>
                        </div>
                    </div>

                    <!-- Listado Detallado de Órdenes -->
                    <div class="card shadow-sm mt-4">
                        <div class="card-header"><h5 class="mb-0">Listado Detallado de Órdenes</h5></div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Producto</th>
                                            <th>Operador</th>
                                            <th>Cant. Plan</th>
                                            <th>Cant. Real</th>
                                            <th>Costo Real</th>
                                            <th>Sobrecosto</th>
                                            <th>Estado</th>
                                            <th>Fecha Fin</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detailedOrdersTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mt-4">
                        <div class="col-lg-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-header"><h5 class="mb-0">Análisis por Operador (Productos Finales)</h5></div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead><tr><th>Operador</th><th>Órdenes Comp.</th><th>Unidades Prod.</th><th>Costo Real</th><th>Scosto Total</th></tr></thead>
                                            <tbody id="operatorReportTableBodyFinal"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-header"><h5 class="mb-0">Análisis por Producto (Productos Finales)</h5></div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead><tr><th>Producto</th><th>Órdenes Comp.</th><th>Unidades Prod.</th><th>Costo Unit.</th><th>Costo Real</th><th>Scosto Total</th></tr></thead>
                                            <tbody id="productReportTableBodyFinal"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mt-4">
                        <div class="col-lg-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-header"><h5 class="mb-0">Análisis por Operador (Productos Intermedios)</h5></div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead><tr><th>Operador</th><th>Órdenes Comp.</th><th>Unidades Prod.</th><th>Costo Real</th><th>Scosto Total</th></tr></thead>
                                            <tbody id="operatorReportTableBodyIntermediate"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-header"><h5 class="mb-0">Análisis por Producto (Productos Intermedios)</h5></div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead><tr><th>Producto</th><th>Órdenes Comp.</th><th>Unidades Prod.</th><th>Costo Unit.</th><th>Costo Real</th><th>Scosto Total</th></tr></thead>
                                            <tbody id="productReportTableBodyIntermediate"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mt-4">
                        <div class="card-header"><h5 class="mb-0">Análisis por Equipo</h5></div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm">
                                    <thead><tr><th>Equipo</th><th>Órdenes Comp.</th><th>Unidades Prod.</th><th>Costo Real</th><th>Sobrecosto Total</th></tr></thead>
                                    <tbody id="equipoReportTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Análisis de Consumo de Materiales -->
                    <div class="card shadow-sm mt-4">
                        <div class="card-header"><h5 class="mb-0">Análisis de Consumo de Materiales</h5></div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm">
                                    <thead><tr><th>Material</th><th>Cantidad Total Consumida</th><th>Costo Total de Consumo</th></tr></thead>
                                    <tbody id="materialReportTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración -->
                <div class="page-content" id="settingsPage" style="display: none;">
                    <h1 class="mt-4">Configuración</h1>
                    <div class="row g-4 mt-2">
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">Gestión de Operadores</h5><button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#operatorModal"><i class="fas fa-plus"></i></button></div><div class="card-body"><ul class="list-group list-group-flush" id="operatorsList"></ul></div></div></div>
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">Gestión de Equipos</h5><button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#equipoModal"><i class="fas fa-plus"></i></button></div><div class="card-body"><ul class="list-group list-group-flush" id="equiposList"></ul></div></div></div>
                        <div class="col-lg-6 mt-4"><div class="card shadow-sm h-100"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">Gestión de Almacenes</h5><button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#almacenModal"><i class="fas fa-plus"></i></button></div><div class="card-body"><ul class="list-group list-group-flush" id="almacenesList"></ul></div></div></div>
                    </div>
                    <div class="row g-4 mt-4">
                    <div class="col-lg-6" id="userManagementCard" style="display: none;"><div class="card shadow-sm h-100"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">Gestión de Usuarios</h5><button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#userModal"><i class="fas fa-plus"></i></button></div><div class="card-body"><ul class="list-group list-group-flush" id="usersList"></ul></div></div></div>
                        <div class="col-lg-6"><div class="card shadow-sm h-100"><div class="card-header"><h5 class="mb-0">Copia de Seguridad</h5></div><div class="card-body text-center"><p class="text-muted">Guarda todos tus datos en un archivo JSON o restaura desde una copia de seguridad anterior.</p><button class="btn btn-success w-100 mb-2" id="backupBtn"><i class="fas fa-save me-2"></i> Crear Copia de Seguridad Local</button><button class="btn btn-secondary w-100 mb-2" id="restoreBtn"><i class="fas fa-upload me-2"></i> Restaurar Copia Local</button><input type="file" id="importBackupFile" accept=".json" class="d-none"></div></div></div>
                        <div class="col-lg-6" style="display: none;"><div class="card shadow-sm"><div class="card-header"><h5 class="mb-0">Logo de la Empresa para PDFs</h5></div><div class="card-body"><p class="text-muted">Sube el logo de tu empresa (PNG o JPG). Se guardará en tu navegador y aparecerá en los PDFs.</p><div class="d-flex align-items-center"><div class="me-3"><img id="logoPreview" src="" alt="Vista previa del logo" style="max-height: 60px; max-width: 200px; display: none;"><p id="noLogoText" class="text-muted fst-italic">No hay logo cargado.</p></div><div class="flex-grow-1"><input class="form-control" type="file" id="logoUpload" accept="image/png, image/jpeg"></div></div></div></div></div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- MODALES -->
<!-- Modal de Verificación de Materiales -->
<div class="modal fade" id="materialCheckModal" tabindex="-1" aria-labelledby="materialCheckModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="materialCheckModalLabel"><i class="fas fa-clipboard-check me-2"></i>Verificación de Disponibilidad de Materiales</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-heading">¡Atención!</h4>
                    <p>Se ha detectado un faltante en algunos materiales necesarios para cumplir con el plan de producción. A continuación se muestra el detalle.</p>
                    <hr>
                    <p class="mb-0">Puede continuar y generar las órdenes de producción (se crearán aunque falten materiales) o cancelar para ajustar el plan.</p>
                </div>

                <div class="card mt-4">
                    <div class="card-header bg-danger text-white">
                        <h6 class="mb-0">Materiales con Faltante</h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped mb-0">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Requerido</th>
                                        <th>En Stock</th>
                                        <th>Faltante</th>
                                    </tr>
                                </thead>
                                <tbody id="materialShortageTableBody">
                                    <!-- Filas generadas por JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0">Listado Completo de Materiales Requeridos</h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Requerido</th>
                                        <th>En Stock</th>
                                        <th>Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="materialFullTableBody">
                                    <!-- Filas generadas por JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelPlanBtn">Cancelar Plan</button>
                <button type="button" class="btn btn-primary" id="continuePlanBtn">Continuar y Crear Órdenes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="userModalLabel">Añadir/Editar Usuario</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="userForm"><div class="modal-body"><p class="text-muted small">Para añadir un nuevo usuario, primero créelo en la Consola de Firebase Authentication. Luego, copie el <strong>UID</strong> de ese usuario desde la consola y péguelo aquí, junto con su correo y rol.</p><div class="mb-3"><label for="userUid" class="form-label">User UID</label><input type="text" class="form-control" id="userUid" required placeholder="Copiar UID de Firebase Console"></div><div class="mb-3"><label for="userEmail" class="form-label">Correo Electrónico</label><input type="email" class="form-control" id="userEmail" required></div><div class="mb-3"><label for="userRole" class="form-label">Rol</label><select id="userRole" class="form-select" required><option value="Supervisor">Supervisor</option><option value="Administrator">Administrador</option></select></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="productModalLabel">Añadir Producto</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="productForm"><div class="modal-body"><div class="mb-3"><label for="productCode" class="form-label">Código</label><input type="text" class="form-control" id="productCode" required></div><div class="mb-3"><label for="productDescription" class="form-label">Descripción</label><input type="text" class="form-control" id="productDescription" required></div><div class="mb-3"><label for="productUnit" class="form-label">Unidad</label><input type="text" class="form-control" id="productUnit" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>
<div class="modal fade" id="materialModal" tabindex="-1" aria-labelledby="materialModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="materialModalLabel">Añadir Material</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="materialForm"><div class="modal-body"><div class="mb-3"><label for="materialCode" class="form-label">Código</label><input type="text" class="form-control" id="materialCode" required></div><div class="mb-3"><label for="materialDescription" class="form-label">Descripción</label><input type="text" class="form-control" id="materialDescription" required></div><div class="mb-3"><label for="materialUnit" class="form-label">Unidad</label><input type="text" class="form-control" id="materialUnit" required></div><div id="materialInventario" class="mb-3">
    <!-- Dynamic warehouse inventory fields will be injected here -->
</div><div class="mb-3"><label for="materialCost" class="form-label">Costo</label><input type="number" class="form-control" id="materialCost" step="0.01" min="0" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>

<!-- Modal Añadir Receta -->
<div class="modal fade" id="addRecipeModal" tabindex="-1" aria-labelledby="addRecipeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addRecipeModalLabel">Añadir Receta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addRecipeForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="recipeProductSelect" class="form-label">Seleccione Producto</label>
                        <select class="form-select" id="recipeProductSelect" required></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ingredientes</label>
                        <div class="row fw-bold border-bottom pb-2 mb-2 d-none d-md-flex">
                            <div class="col-md-2">Tipo</div>
                            <div class="col-md-3">Código</div>
                            <div class="col-md-4">Descripción</div>
                            <div class="col-md-2">Cantidad</div>
                            <div class="col-md-1"></div>
                        </div>
                        <div id="recipeMaterials"></div>
                        <button type="button" class="btn btn-sm btn-outline-success" id="addMaterialToRecipeBtn">
                            <i class="fas fa-plus"></i> Añadir ingrediente
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar Receta</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Editar Receta -->
<div class="modal fade" id="editRecipeModal" tabindex="-1" aria-labelledby="editRecipeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editRecipeModalLabel">Editar Receta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editRecipeForm">
                <div class="modal-body">
                    <div class="row align-items-end mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Producto</label>
                            <select class="form-select" id="editRecipeProductSelect" disabled></select>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-end justify-content-end">
                                <div class="me-3">
                                    <label for="recipeSimulationAlmacen" class="form-label">Simular desde Almacén:</label>
                                    <select id="recipeSimulationAlmacen" class="form-select form-select-sm"></select>
                                </div>
                                <div>
                                    <label for="recipeSimulationQty" class="form-label">Unidades:</label>
                                    <input type="number" id="recipeSimulationQty" class="form-control form-control-sm" placeholder="Ej: 100" style="width: 8em;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ingredientes</label>
                        <div class="row fw-bold border-bottom pb-2 mb-2 d-none d-md-flex">
                            <div class="col-md-2" style="max-width: 120px;">Tipo</div>
                            <div class="col-md-2" style="max-width: 120px;">Código</div>
                            <div class="col-md-3">Descripción</div>
                            <div class="col-md-1">Cantidad</div>
                            <div class="col-md-2" style="max-width: 150px;">Requerido</div>
                            <div class="col-md-1" style="max-width: 100px;">Alerta</div>
                            <div class="col-md-1"></div>
                        </div>
                        <div id="editRecipeMaterials"></div>
                        <button type="button" class="btn btn-sm btn-outline-success mt-2" id="addMaterialToEditRecipeBtn">
                            <i class="fas fa-plus"></i> Añadir ingrediente
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Resto de modales -->
<div class="modal fade" id="productionOrderModal" tabindex="-1" aria-labelledby="productionOrderModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="productionOrderModalLabel">Crear Orden de Producción</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="productionOrderForm"><div class="modal-body"><div class="mb-3"><label for="orderProductSelect" class="form-label">Producto</label><select class="form-select" id="orderProductSelect" required></select></div><div class="mb-3"><label for="orderQuantity" class="form-label">Cantidad</label><input type="number" class="form-control" id="orderQuantity" min="1" required></div><div class="mb-3"><label for="orderAlmacenSelect" class="form-label">Almacén de Producción</label><select class="form-select" id="orderAlmacenSelect" required></select></div><div class="mb-3"><label for="orderEquipoSelect" class="form-label">Equipo</label><select class="form-select" id="orderEquipoSelect" required></select></div><div class="mb-3"><label for="orderOperatorSelect" class="form-label">Operador</label><select class="form-select" id="orderOperatorSelect" required></select></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Crear Orden</button></div></form></div></div></div>
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="orderDetailsModalLabel">Detalles de Orden de Producción</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="row"><div class="col-md-6"><p><strong>ID de Orden:</strong> <span id="detailOrderId"></span></p><p><strong>Producto:</strong> <span id="detailProductName"></span></p><p><strong>Operador:</strong> <span id="detailOperatorName"></span></p><p><strong>Equipo:</strong> <span id="detailEquipoName"></span></p><p><strong>Estado:</strong> <span id="detailStatus" class="badge"></span></p></div><div class="col-md-6"><p><strong>Cantidad Planificada:</strong> <span id="detailQuantityPlanned"></span></p><p><strong>Cantidad Real Producida:</strong> <span id="detailQuantityProduced"></span></p><p><strong>Fecha de Creación:</strong> <span id="detailCreatedDate"></span></p><p><strong>Fecha de Finalización:</strong> <span id="detailCompletedDate"></span></p><p><strong>Vales Emitidos:</strong> <span id="detailValeCount" class="badge bg-info">0</span></p></div></div><hr><div class="row"><div class="col-md-4"><p><strong>Costo Estándar:</strong> <span id="detailStandardCost"></span></p></div><div class="col-md-4"><p><strong>Costo Extra (Vales):</strong> <span id="detailExtraCost"></span></p></div><div class="col-md-4"><p><strong>Costo Real Total:</strong> <span id="detailRealCost" class="fw-bold"></span></p></div></div><div class="alert alert-info d-flex justify-content-between align-items-center"><strong class="h5">Sobrecosto (Variación):</strong><strong class="h5" id="detailOvercost"></strong></div><h6 class="mt-4">Materiales Consolidados (Receta + Vales)</h6><div class="table-responsive"><table class="table table-sm table-bordered"><thead><tr><th>Código</th><th>Descripción</th><th class="th-multiline">Cantidad<br>(plan/real)</th><th class="th-multiline">Costo<br>(plan/real)</th></tr></thead><tbody id="detailMaterialsTableBody"></tbody></table></div><hr class="my-4"><div id="detailValesContainer"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div></div></div></div>
<div class="modal fade" id="valeModal" tabindex="-1" aria-labelledby="valeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="valeModalLabel">Crear Vale para Orden #<span id="valeOrderId"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="valeForm"><div class="modal-body"><input type="hidden" id="valeHiddenOrderId"><div class="row"><div class="col-md-6 mb-3"><label for="valeType" class="form-label">Tipo de Vale</label><select id="valeType" class="form-select"><option value="salida">Salida de Almacén</option><option value="devolucion">Devolución a Almacén</option></select></div><div class="col-md-6 mb-3"><label for="valeAlmacen" class="form-label">Almacén</label><select id="valeAlmacen" class="form-select" required></select></div></div><p>Ingrese las cantidades de materiales (existentes o nuevos):</p><div class="table-responsive"><table class="table table-sm"><thead><tr><th style="width: 25%;">Código</th><th style="width: 35%;">Descripción</th><th style="width: 20%;">Existencia</th><th style="width: 20%;">Cantidad</th></tr></thead><tbody id="valeMaterialsTableBody"></tbody></table></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary">Guardar y Descargar PDF</button></div></form></div></div></div>
<div class="modal fade" id="confirmCloseOrderModal" tabindex="-1" aria-labelledby="confirmCloseOrderModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="confirmCloseOrderModalLabel">Confirmar Cierre de Orden</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="confirmCloseOrderForm"><div class="modal-body"><p>Antes de cerrar la orden, confirme la <strong>cantidad real</strong> de unidades producidas y el <strong>almacén</strong> a afectar.</p><input type="hidden" id="closeHiddenOrderId"><div class="mb-3"><label for="realQuantityInput" class="form-label">Cantidad Real Producida</label><input type="number" class="form-control" id="realQuantityInput" min="0" step="1" required></div><div class="mb-3"><label for="completionAlmacenSelect" class="form-label">Almacén de Producción</label><select id="completionAlmacenSelect" class="form-select" required></select><div class="form-text">Las materias primas se descontarán y el producto terminado se añadirá a este almacén.</div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-success">Confirmar y Cerrar Orden</button></div></form></div></div></div>
<div class="modal fade" id="operatorModal" tabindex="-1" aria-labelledby="operatorModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="operatorModalLabel">Añadir Operador</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="operatorForm"><div class="modal-body"><div class="mb-3"><label for="operatorId" class="form-label">ID del Operador</label><input type="text" class="form-control" id="operatorId" required></div><div class="mb-3"><label for="operatorName" class="form-label">Nombre del Operador</label><input type="text" class="form-control" id="operatorName" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>
<div class="modal fade" id="equipoModal" tabindex="-1" aria-labelledby="equipoModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="equipoModalLabel">Añadir Equipo</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="equipoForm"><div class="modal-body"><div class="mb-3"><label for="equipoId" class="form-label">ID del Equipo</label><input type="text" class="form-control" id="equipoId" required></div><div class="mb-3"><label for="equipoName" class="form-label">Nombre del Equipo</label><input type="text" class="form-control" id="equipoName" required></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>

<div class="modal fade" id="almacenModal" tabindex="-1" aria-labelledby="almacenModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="almacenModalLabel">Añadir Almacén</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><form id="almacenForm"><div class="modal-body"><div class="mb-3"><label for="almacenId" class="form-label">ID del Almacén</label><input type="text" class="form-control" id="almacenId" required></div><div class="mb-3"><label for="almacenName" class="form-label">Nombre del Almacén</label><input type="text" class="form-control" id="almacenName" required></div><div class="form-check mb-3"><input class="form-check-input" type="checkbox" id="almacenDefault"><label class="form-check-label" for="almacenDefault">Almacén por defecto para producción</label></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button><button type="submit" class="btn btn-primary">Guardar</button></div></form></div></div></div>

<!-- Modal Traspaso de Materiales -->
<div class="modal fade" id="traspasoModal" tabindex="-1" aria-labelledby="traspasoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="traspasoModalLabel">Traspaso de Material entre Almacenes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="traspasoForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="traspasoMaterialSelect" class="form-label">Material a Traspasar</label>
                        <select class="form-select" id="traspasoMaterialSelect" required></select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="traspasoOrigenSelect" class="form-label">Almacén Origen</label>
                            <select class="form-select" id="traspasoOrigenSelect" required></select>
                            <div class="form-text">Existencia: <span id="traspasoStockOrigen" class="fw-bold">--</span></div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="traspasoDestinoSelect" class="form-label">Almacén Destino</label>
                            <select class="form-select" id="traspasoDestinoSelect" required></select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="traspasoCantidad" class="form-label">Cantidad a Traspasar</label>
                        <input type="number" class="form-control" id="traspasoCantidad" min="0.01" step="0.01" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Confirmar Traspaso</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script type="module" src="main_v2.js"></script>
</body>
</html>
